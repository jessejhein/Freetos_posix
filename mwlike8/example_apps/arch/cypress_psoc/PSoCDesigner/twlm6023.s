	.module twlm6023.c
	.area lit(rom, con, rel)
_Font_Table::
	.byte 0,0
	.byte 0,0
	.byte 0,64
	.byte 0,0
	.byte 0,96
	.byte 48,24
	.byte 12,6
	.byte 2,0
	.byte 0,124
	.byte 'B,'B
	.byte 62,0
	.byte 0,0
	.byte 0,0
	.byte 4,126
	.byte 0,0
	.byte 0,0
	.byte 0,0
	.byte 'D,'b
	.byte 'R,'L
	.byte 0,0
	.byte 0,0
	.byte 36,'B
	.byte 'J,52
	.byte 0,0
	.byte 0,48
	.byte 40,36
	.byte 126,32
	.byte 0,0
	.byte 0,'N
	.byte 'J,'J
	.byte 50,0
	.byte 0,0
	.byte 0,60
	.byte 'J,'J
	.byte 50,0
	.byte 0,0
	.byte 0,2
	.byte 'b,26
	.byte 6,0
	.byte 0,0
	.byte 0,52
	.byte 'J,'J
	.byte 52,0
	.byte 0,0
	.byte 0,30
	.byte 18,18
	.byte 126,0
	.byte 0,0
	.byte 0,0
	.byte 0,0
	.byte 36,0
	.byte 0,0
	.byte 0,0
	.byte 0,64
	.byte 52,0
	.byte 0,0
	.byte 0,16
	.byte 40,40
	.byte 40,'D
	.byte 0,0
	.byte 0,40
	.byte 40,40
	.byte 40,40
	.byte 0,0
	.byte 0,'D
	.byte 40,40
	.byte 40,16
	.byte 0,0
	.byte 0,4
	.byte 2,178
	.byte 18,12
	.byte 0,0
	.byte 0,124
	.byte 198,250
	.byte 142,230
	.byte 60,0
	.byte 0,96
	.byte 28,18
	.byte 28,96
	.byte 0,0
	.byte 0,126
	.byte 'J,'J
	.byte 60,0
	.byte 0,0
	.byte 0,124
	.byte 130,130
	.byte 130,'D
	.byte 0,0
	.byte 0,126
	.byte 'B,'B
	.byte 'B,60
	.byte 0,0
	.byte 0,126
	.byte 'J,'J
	.byte 'J,'B
	.byte 0,0
	.byte 0,126
	.byte 18,18
	.byte 2,0
	.byte 0,0
	.byte 0,60
	.byte 'B,'B
	.byte 'R,52
	.byte 0,0
	.byte 0,126
	.byte 8,8
	.byte 8,126
	.byte 0,0
	.byte 0,0
	.byte 0,126
	.byte 0,0
	.byte 0,0
	.byte 0,96
	.byte 64,64
	.byte 62,0
	.byte 0,0
	.byte 0,126
	.byte 8,20
	.byte 34,64
	.byte 0,0
	.byte 0,126
	.byte 64,64
	.byte 64,0
	.byte 0,0
	.byte 0,126
	.byte 4,24
	.byte 16,4
	.byte 126,0
	.byte 0,126
	.byte 4,8
	.byte 48,126
	.byte 0,0
	.byte 0,60
	.byte 'B,'B
	.byte 'B,60
	.byte 0,0
	.byte 0,126
	.byte 10,10
	.byte 14,0
	.byte 0,0
	.byte 0,60
	.byte 'B,'B
	.byte 'b,92
	.byte 0,0
	.byte 0,126
	.byte 18,18
	.byte 50,'L
	.byte 0,0
	.byte 0,0
	.byte 44,'J
	.byte 'R,52
	.byte 0,0
	.byte 0,2
	.byte 2,126
	.byte 2,2
	.byte 0,0
	.byte 0,62
	.byte 64,64
	.byte 64,62
	.byte 0,0
	.byte 0,14
	.byte 48,64
	.byte 48,14
	.byte 0,0
	.byte 0,30
	.byte 96,28
	.byte 56,96
	.byte 30,0
	.byte 0,'B
	.byte 52,8
	.byte 52,'B
	.byte 0,0
	.byte 0,2
	.byte 12,'p
	.byte 12,2
	.byte 0,0
	.byte 0,'b
	.byte 'R,'J
	.byte 'J,'F
	.byte 'B,0
	.byte 0,0
	.byte 0,0
	.byte 255,129
	.byte 0,0
	.byte 0,0
	.byte 0,6
	.byte 56,192
	.byte 0,0
	.byte 0,0
	.byte 129,255
	.byte 0,0
	.byte 0,0
	.byte 0,0
	.byte 0,12
	.byte 2,12
	.byte 0,0
	.byte 0,0
	.byte 64,64
	.byte 64,64
	.byte 64,0
	.byte 0,0
	.byte 0,0
	.byte 6,8
	.byte 0,0
	.byte 0,0
	.byte 'd,'T
	.byte 'T,124
	.byte 0,0
	.byte 0,0
	.byte 127,'D
	.byte 'D,56
	.byte 0,0
	.byte 0,0
	.byte 56,'D
	.byte 'D,40
	.byte 0,0
	.byte 0,0
	.byte 56,'D
	.byte 'D,127
	.byte 0,0
	.byte 0,0
	.byte 56,'T
	.byte 'T,'X
	.byte 0,0
	.byte 0,0
	.byte 4,126
	.byte 5,0
	.byte 0,0
	.byte 0,0
	.byte 46,'Q
	.byte 'Q,63
	.byte 0,0
	.byte 0,0
	.byte 127,4
	.byte 4,'x
	.byte 0,0
	.byte 0,0
	.byte 0,0
	.byte 125,0
	.byte 0,0
	.byte 0,0
	.byte 64,128
	.byte 125,0
	.byte 0,0
	.byte 0,0
	.byte 127,16
	.byte 56,'D
	.byte 0,0
	.byte 0,0
	.byte 0,0
	.byte 127,0
	.byte 0,0
	.byte 0,124
	.byte 4,4
	.byte 124,4
	.byte 4,'x
	.byte 0,0
	.byte 124,4
	.byte 4,'x
	.byte 0,0
	.byte 0,0
	.byte 56,'D
	.byte 'D,56
	.byte 0,0
	.byte 0,0
	.byte 254,34
	.byte 34,28
	.byte 0,0
	.byte 0,0
	.byte 28,34
	.byte 34,254
	.byte 0,0
	.byte 0,0
	.byte 0,124
	.byte 4,4
	.byte 0,0
	.byte 0,0
	.byte 'H,'T
	.byte 'T,36
	.byte 0,0
	.byte 0,0
	.byte 0,4
	.byte 126,'D
	.byte 0,0
	.byte 0,0
	.byte 60,64
	.byte 64,124
	.byte 0,0
	.byte 0,0
	.byte 4,56
	.byte 64,56
	.byte 4,0
	.byte 0,0
	.byte 60,64
	.byte 60,64
	.byte 60,0
	.byte 0,0
	.byte 'D,56
	.byte 56,'D
	.byte 0,0
	.byte 0,0
	.byte 2,156
	.byte 96,28
	.byte 2,0
	.byte 0,0
	.byte 0,'d
	.byte 'T,'L
	.byte 0,0
	.dbfile ./twlm6023.c
	.dbsym e Font_Table _Font_Table A[616:77:8]c
_Font_SPACE::
	.byte 0,0
	.byte 0,0
	.byte 0,0
	.byte 0,0
	.dbsym e Font_SPACE _Font_SPACE A[8:8]c
_Font_DEGREE::
	.byte 0,12
	.byte 18,18
	.byte 12,0
	.byte 0,0
	.dbsym e Font_DEGREE _Font_DEGREE A[8:8]c
_Font_EXC::
	.byte 0,0
	.byte 0,94
	.byte 0,0
	.byte 0,0
	.dbsym e Font_EXC _Font_EXC A[8:8]c
_ClearPaper::
	.byte 0
	.dbsym e ClearPaper _ClearPaper A[1:1]c
	.area text(rom, con, rel)
	.dbfile ./twlm6023.c
	.dbfunc e scr_open _scr_open fV
_scr_open::
	.dbline -1
	.dbline 127
; /*
;  * Copyright (c) 05-05-2004 cheng chung yan <yan@amonics.com> for 8-bit system
;  *
;  * In mono LCD, 128X64 configuration, topway(http://www.topwaydisplay.com/) lm6023
;  * hardware setting under Laser Control circuit by PSoC
;  *
;  * Char mode
;  * hardware setting 
;  *	PSoC
;                 // chip's hardware setting
;                 //      * 24MHz cpu clk
;                 //      * reset and CS as pull high (for faster response on active low)
;                 //      * A0, D6 and D7 as strong (for faster response on any stage)
;                    init. 
;                         * from util/sys start init.
;                                 * chip select disable 
;                                 * reset 
;                         * local init.
;  *	LCD
;                 whole screen - 128X64
;                 font - 8x8
;  */
; 
; #include "app.h"									// linlike8 os
; 
; #if (GUI_LCD==1)
; #include "nano-X.h"
; #include "device.h"									// scr_open
; #include "system.h"									// cli()
; #include "twlm6023.h"									// hw bet. lcd and mcu
; 
; // Continuous ASCII Code so use 2D Table
; const unsigned char Font_Table[][8]=
; {
; 	//{ 0x00, 0x00, 0x14, 0x0E, 0x14, 0x00, 0x00, 0x00 },		// ASCII=0x2A
; 	//{ 0x00, 0x10, 0x10, 0x7C, 0x10, 0x10, 0x00, 0x00 },		// ASCII=0x2B
; 	//{ 0x00, 0x00, 0x00, 0x00, 0x80, 0x60, 0x00, 0x00 },		// ASCII=0x2C
; 	//{ 0x00, 0x00, 0x10, 0x10, 0x10, 0x00, 0x00, 0x00 },		// ASCII=0x2D
; 	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00 },		// ASCII=0x2E
; 	{ 0x00, 0x60, 0x30, 0x18, 0x0C, 0x06, 0x02, 0x00 },		// ASCII=0x2F
; 	{ 0x00, 0x7C, 0x42, 0x42, 0x3E, 0x00, 0x00, 0x00 },		// ASCII=0x30
; 	{ 0x00, 0x00, 0x04, 0x7E, 0x00, 0x00, 0x00, 0x00 },		// ASCII=0x31
; 	{ 0x00, 0x00, 0x44, 0x62, 0x52, 0x4C, 0x00, 0x00 },		// ASCII=0x32
; 	{ 0x00, 0x00, 0x24, 0x42, 0x4A, 0x34, 0x00, 0x00 },		// ASCII=0x33
; 	{ 0x00, 0x30, 0x28, 0x24, 0x7E, 0x20, 0x00, 0x00 },		// ASCII=0x34
; 	{ 0x00, 0x4E, 0x4A, 0x4A, 0x32, 0x00, 0x00, 0x00 },		// ASCII=0x35
; 	{ 0x00, 0x3C, 0x4A, 0x4A, 0x32, 0x00, 0x00, 0x00 },		// ASCII=0x36
; 	{ 0x00, 0x02, 0x62, 0x1A, 0x06, 0x00, 0x00, 0x00 },		// ASCII=0x37
; 	{ 0x00, 0x34, 0x4A, 0x4A, 0x34, 0x00, 0x00, 0x00 },		// ASCII=0x38
; 	{ 0x00, 0x1E, 0x12, 0x12, 0x7E, 0x00, 0x00, 0x00 },		// ASCII=0x39
; 	{ 0x00, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00 },		// ASCII=0x3A
; 	{ 0x00, 0x00, 0x00, 0x40, 0x34, 0x00, 0x00, 0x00 },		// ASCII=0x3B
; 	{ 0x00, 0x10, 0x28, 0x28, 0x28, 0x44, 0x00, 0x00 },		// ASCII=0x3C
; 	{ 0x00, 0x28, 0x28, 0x28, 0x28, 0x28, 0x00, 0x00 },		// ASCII=0x3D
; 	{ 0x00, 0x44, 0x28, 0x28, 0x28, 0x10, 0x00, 0x00 },		// ASCII=0x3E
; 	{ 0x00, 0x04, 0x02, 0xB2, 0x12, 0x0C, 0x00, 0x00 },		// ASCII=0x3F
; 	{ 0x00, 0x7C, 0xC6, 0xFA, 0x8E, 0xE6, 0x3C, 0x00 },		// ASCII=0x40
; 	{ 0x00, 0x60, 0x1C, 0x12, 0x1C, 0x60, 0x00, 0x00 },		// ASCII=0x41
; 	{ 0x00, 0x7E, 0x4A, 0x4A, 0x3C, 0x00, 0x00, 0x00 },		// ASCII=0x42
; 	{ 0x00, 0x7C, 0x82, 0x82, 0x82, 0x44, 0x00, 0x00 },		// ASCII=0x43
; 	{ 0x00, 0x7E, 0x42, 0x42, 0x42, 0x3C, 0x00, 0x00 },		// ASCII=0x44
; 	{ 0x00, 0x7E, 0x4A, 0x4A, 0x4A, 0x42, 0x00, 0x00 },		// ASCII=0x45
; 	{ 0x00, 0x7E, 0x12, 0x12, 0x02, 0x00, 0x00, 0x00 },		// ASCII=0x46
; 	{ 0x00, 0x3C, 0x42, 0x42, 0x52, 0x34, 0x00, 0x00 },		// ASCII=0x47
; 	{ 0x00, 0x7E, 0x08, 0x08, 0x08, 0x7E, 0x00, 0x00 },		// ASCII=0x48
; 	{ 0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00 },		// ASCII=0x49
; 	{ 0x00, 0x60, 0x40, 0x40, 0x3E, 0x00, 0x00, 0x00 },		// ASCII=0x4A
; 	{ 0x00, 0x7E, 0x08, 0x14, 0x22, 0x40, 0x00, 0x00 },		// ASCII=0x4B
; 	{ 0x00, 0x7E, 0x40, 0x40, 0x40, 0x00, 0x00, 0x00 },		// ASCII=0x4C
; 	{ 0x00, 0x7E, 0x04, 0x18, 0x10, 0x04, 0x7E, 0x00 },		// ASCII=0x4D
; 	{ 0x00, 0x7E, 0x04, 0x08, 0x30, 0x7E, 0x00, 0x00 },		// ASCII=0x4E
; 	{ 0x00, 0x3C, 0x42, 0x42, 0x42, 0x3C, 0x00, 0x00 },		// ASCII=0x4F
; 	{ 0x00, 0x7E, 0x0A, 0x0A, 0x0E, 0x00, 0x00, 0x00 },		// ASCII=0x50
; 	{ 0x00, 0x3C, 0x42, 0x42, 0x62, 0x5C, 0x00, 0x00 },		// ASCII=0x51
; 	{ 0x00, 0x7E, 0x12, 0x12, 0x32, 0x4C, 0x00, 0x00 },		// ASCII=0x52
; 	{ 0x00, 0x00, 0x2C, 0x4A, 0x52, 0x34, 0x00, 0x00 },		// ASCII=0x53
; 	{ 0x00, 0x02, 0x02, 0x7E, 0x02, 0x02, 0x00, 0x00 },		// ASCII=0x54
; 	{ 0x00, 0x3E, 0x40, 0x40, 0x40, 0x3E, 0x00, 0x00 },		// ASCII=0x55
; 	{ 0x00, 0x0E, 0x30, 0x40, 0x30, 0x0E, 0x00, 0x00 },		// ASCII=0x56
; 	{ 0x00, 0x1E, 0x60, 0x1C, 0x38, 0x60, 0x1E, 0x00 },		// ASCII=0x57
; 	{ 0x00, 0x42, 0x34, 0x08, 0x34, 0x42, 0x00, 0x00 },		// ASCII=0x58
; 	{ 0x00, 0x02, 0x0C, 0x70, 0x0C, 0x02, 0x00, 0x00 },		// ASCII=0x59
; 	{ 0x00, 0x62, 0x52, 0x4A, 0x4A, 0x46, 0x42, 0x00 },		// ASCII=0x5A
; 	{ 0x00, 0x00, 0x00, 0x00, 0xFF, 0x81, 0x00, 0x00 },		// ASCII=0x5B
; 	{ 0x00, 0x00, 0x00, 0x06, 0x38, 0xC0, 0x00, 0x00 },		// ASCII=0x5C
; 	{ 0x00, 0x00, 0x81, 0xFF, 0x00, 0x00, 0x00, 0x00 },		// ASCII=0x5D
; 	{ 0x00, 0x00, 0x00, 0x0C, 0x02, 0x0C, 0x00, 0x00 },		// ASCII=0x5E
; 	{ 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00 },		// ASCII=0x5F
; 	{ 0x00, 0x00, 0x00, 0x00, 0x06, 0x08, 0x00, 0x00 },		// ASCII=0x60
; 	{ 0x00, 0x00, 0x64, 0x54, 0x54, 0x7C, 0x00, 0x00 },		// ASCII=0x61
; 	{ 0x00, 0x00, 0x7F, 0x44, 0x44, 0x38, 0x00, 0x00 },		// ASCII=0x62
; 	{ 0x00, 0x00, 0x38, 0x44, 0x44, 0x28, 0x00, 0x00 },		// ASCII=0x63
; 	{ 0x00, 0x00, 0x38, 0x44, 0x44, 0x7F, 0x00, 0x00 },		// ASCII=0x64
; 	{ 0x00, 0x00, 0x38, 0x54, 0x54, 0x58, 0x00, 0x00 },		// ASCII=0x65
; 	{ 0x00, 0x00, 0x04, 0x7E, 0x05, 0x00, 0x00, 0x00 },		// ASCII=0x66
; 	{ 0x00, 0x00, 0x2E, 0x51, 0x51, 0x3F, 0x00, 0x00 },		// ASCII=0x67
; 	{ 0x00, 0x00, 0x7F, 0x04, 0x04, 0x78, 0x00, 0x00 },		// ASCII=0x68
; 	{ 0x00, 0x00, 0x00, 0x00, 0x7D, 0x00, 0x00, 0x00 },		// ASCII=0x69
; 	{ 0x00, 0x00, 0x40, 0x80, 0x7D, 0x00, 0x00, 0x00 },		// ASCII=0x6A
; 	{ 0x00, 0x00, 0x7F, 0x10, 0x38, 0x44, 0x00, 0x00 },		// ASCII=0x6B
; 	{ 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00 },		// ASCII=0x6C
; 	{ 0x00, 0x7C, 0x04, 0x04, 0x7C, 0x04, 0x04, 0x78 },		// ASCII=0x6D
; 	{ 0x00, 0x00, 0x7C, 0x04, 0x04, 0x78, 0x00, 0x00 },		// ASCII=0x6E
; 	{ 0x00, 0x00, 0x38, 0x44, 0x44, 0x38, 0x00, 0x00 },		// ASCII=0x6F
; 	{ 0x00, 0x00, 0xFE, 0x22, 0x22, 0x1C, 0x00, 0x00 },		// ASCII=0x70
; 	{ 0x00, 0x00, 0x1C, 0x22, 0x22, 0xFE, 0x00, 0x00 },		// ASCII=0x71
; 	{ 0x00, 0x00, 0x00, 0x7C, 0x04, 0x04, 0x00, 0x00 },		// ASCII=0x72
; 	{ 0x00, 0x00, 0x48, 0x54, 0x54, 0x24, 0x00, 0x00 },		// ASCII=0x73
; 	{ 0x00, 0x00, 0x00, 0x04, 0x7E, 0x44, 0x00, 0x00 },		// ASCII=0x74
; 	{ 0x00, 0x00, 0x3C, 0x40, 0x40, 0x7C, 0x00, 0x00 },		// ASCII=0x75
; 	{ 0x00, 0x00, 0x04, 0x38, 0x40, 0x38, 0x04, 0x00 },		// ASCII=0x76
; 	{ 0x00, 0x00, 0x3C, 0x40, 0x3C, 0x40, 0x3C, 0x00 },		// ASCII=0x77
; 	{ 0x00, 0x00, 0x44, 0x38, 0x38, 0x44, 0x00, 0x00 },		// ASCII=0x78
; 	{ 0x00, 0x00, 0x02, 0x9C, 0x60, 0x1C, 0x02, 0x00 },		// ASCII=0x79
; 	{ 0x00, 0x00, 0x00, 0x64, 0x54, 0x4C, 0x00, 0x00 },		// ASCII=0x7A
; 
; };
; 
; const unsigned char Font_SPACE[]={ 00, 00, 00, 00, 00, 00, 00, 00 };                            // ASCII=0x20
; const unsigned char Font_DEGREE[]={ 0x00, 0x0C, 0x12, 0x12, 0x0C, 0x00, 0x00, 0x00 };           // ASCII=0xA7
; const unsigned char Font_EXC[]={ 00, 00, 00, 0x5e, 00, 00, 00, 00 };                            // ASCII=0x21
; const unsigned char ClearPaper[]={0};
; 
; void wrTxLm6023(unsigned char wrAddr, unsigned char wrData);
; 
; void scr_open(void)
; {
	.dbline 129
;         
;         disResetP;
	or REG[16],2
	.dbline 132
;         
; 		// send out hardware reset pulse
;         enResetP;									// delay >1uSec ~ 1.4uSec, under 24MHz cpu clk
	and REG[16],-3
	.dbline 133
;         asm("nop");
		nop

	.dbline 134
;         asm("nop");
		nop

	.dbline 135
;         asm("nop");
		nop

	.dbline 136
;         asm("nop");
		nop

	.dbline 137
;         asm("nop");
		nop

	.dbline 138
;         asm("nop");
		nop

	.dbline 139
;         disResetP;                                      				// some transient ~ 0.4uSec
	or REG[16],2
	.dbline 140
;         asm("nop");                                     				// delay >1uSec ~ 1.2uSec
		nop

	.dbline 141
;         asm("nop");
		nop

	.dbline 142
;         asm("nop");
		nop

	.dbline 143
;         asm("nop");
		nop

	.dbline 144
;         asm("nop");
		nop

	.dbline 145
;         asm("nop");
		nop

	.dbline 150
;         
;         	// set LCD bias, default as 1/8 by hw reset pin, show skip
;         
; 		// set power supply control, default close voltage follower, voltage adjustment and voltage higher by hw reset pin, show skip
;         wrTxLm6023(0x00, 0x2f);                              				// turn ON all voltage control
	mov A,47
	push A
	mov A,0
	push A
	xcall _wrTxLm6023
	add SP,-2
	.dbline 153
;         
;         	// set register control, i.e contrast
;         wrTxLm6023(0x00, 0x94);                              				// set contrast in bit 4 to bit 0 => 0x0f as middle
	mov A,-108
	push A
	mov A,0
	push A
	xcall _wrTxLm6023
	.dbline 159
;         
;         	// ADC setting, i.e. normal or invert display, default as normal; So skip
;         //wrTxLm6023(0x00, 0xa0);
;         
;         	// turn ON LCD
;         wrTxLm6023(0x00, 0xaf);                                				// bit 0 as 1 to ON, 0 as OFF LCD
	mov A,-81
	push A
	mov A,0
	push A
	xcall _wrTxLm6023
	add SP,-4
	.dbline -2
	.dbline 164
;         
;         //wrTxLm6023(0x00, 0xa7);
;         //wrTxLm6023(0x00, 0xa5);                              				// ON all pixel
;         
; }
L3:
	.dbline 0 ; func end
	ret
	.dbend
	.dbfunc e wrTxLm6023 _wrTxLm6023 fV
;              i -> X+0
;         wrData -> X-5
;         wrAddr -> X-4
_wrTxLm6023::
	.dbline -1
	push X
	mov X,SP
	add SP,1
	.dbline 172
; 
;         //----------------------------------------------------------------------------
;         // Description : write data/command into LCD module
;         // parameters : 
;         //      wrPara : bit 7 ( , , , , , , , A0) bit 0
;         //      wrData : Tx data
;         //----------------------------------------------------------------------------
; void wrTxLm6023(unsigned char wrAddr, unsigned char wrData) {
	.dbline 176
;         
;         unsigned char i;
;         
; 	cli();										// disable interrupt, make sure the clock time
		and F, FEh

	.dbline 181
; 	
;         // prepare data port for pull-high
;         
;         // chip select                                                  all timing is cal. under 5V supply
;         enCsP;                                                  // <-| Min. 30 ns from LCD; 24MHz cpu Min. as 4.6us
	and REG[16],-9
	.dbline 184
;                                                                 //   |
;         // A0                                                        |
;         if (wrAddr&0x01) highA0P;                               //   |  <-| Min. 50 ns from LCD; 24MHz cpu Min. as 3.6us
	tst [X-4],1
	jz L5
	.dbline 184
	or REG[16],32
	xjmp L6
L5:
	.dbline 185
;         else lowA0P;                                            //   |    |
	and REG[16],-33
L6:
	.dbline 188
	mov [X+0],0
	xjmp L10
L7:
	.dbline 188
;                                                                 //   |    |
;         // serial tx data for 8 cycle                                |    |
;         for (i=0;i<8;i++) {                                     //   |    |
	.dbline 191
;                                                                 //   |    |
;                 // low serial data clock                             |    |
;                 lowSClk;                                        //   |    |     <-| Min. 250 ns from LCD; 24MHz cpu Min. as 3.2us       <-| Min. 70 ns from LCD; 24MHz cpu Min. as 1.8us        
	and REG[16],127
	.dbline 194
;                                                                 //   |    |       |                                                       |
;                 // prepare data                                      |    |       |                                                       |
;                 if (wrData&0x80) highSD;                        //   |    |       ...                                                     |                                                     <-| Min. 100 ns from LCD; 24MHz cpu Min. as 0.8us
	tst [X-5],-128
	jz L11
	.dbline 194
	or REG[8],2
	xjmp L12
L11:
	.dbline 195
;                 else lowSD;                                     //   |    |       ...                                                     |                                                       | 
	and REG[8],-3
L12:
	.dbline 196
	asl [X-5]
	.dbline 199
	or REG[16],-128
	.dbline 201
L8:
	.dbline 188
	inc [X+0]
L10:
	.dbline 188
	cmp [X+0],8
	jz X0
	jc L7
X0:
	.dbline 203
;                 wrData <<= 1;                                   //   |    |       |                                                       |                                                       | 
;                                                                 //   |    |     <-| next cycle sclk changing,                             |                                                       |  
;                 // high serial data clock                            |    |                                                               |                                                       | 
;                 highSClk;                                       // <-|  <-|  <-| Min. 100ns from LCD; 24MHz cpu Min. as 1.2us           <-|   <-| Min. 500ns from LCD; 24MHz cpu Min. as 5us    <-|   <-| Min. 100ns from LCD; 24MHz cpu Min. as 1.4us  <-| Min. 100ns from LCD; 24MHz cpu Min. as 2.4us
;                                                                 //             |                                                                |                                                       |                                                 |
;         }                                                       //             |                                                                |                                                       |                                                 |
;                                                                 //             |                                                                ...                                                     ...                                               ...
;         disCsP;                                                 //           <-|                                                                ...                                                     ...                                               ...
	or REG[16],8
	.dbline 207
;                                                                 //                                                                              |                                                       |                                                 |
;                                                                 //                                                                            <-| next cycle A0 changing                              <-| next cycle SCLK changing                      <-| next cycle SCLK changing
;         
; 	sti();
		or  F, 01h

	.dbline -2
	.dbline 208
; }
L4:
	add SP,-1
	pop X
	.dbline 0 ; func end
	ret
	.dbsym l i 0 c
	.dbsym l wrData -5 c
	.dbsym l wrAddr -4 c
	.dbend
	.dbfunc e GrBitmapDrv _GrBitmapDrv fV
;        tmpByte -> X+5
;         pageNo -> X+4
;         tmpInt -> X+2
;    dataCounter -> X+0
;          pData -> X-5
_GrBitmapDrv::
	.dbline -1
	push X
	mov X,SP
	add SP,6
	.dbline 223
; 
; /*
;  * Draw a rectangular area in the specified drawable using the specified
;  * graphics, as determined by the specified bit map.  This differs from
;  * rectangle drawing in that the rectangle is drawn using the foreground
;  * color and possibly the background color as determined by the bit map.
;  * Each row of bits is aligned to the next bitmap word boundary (so there
;  * is padding at the end of the row).  The background bit values are only
;  * written if the usebackground flag is set in the GC.
;  *
;  *	for whole screen only temporary
;  */
; void
; GrBitmapDrv(const unsigned char* pData)
; {
	.dbline 230
;         unsigned char pageNo;
;         unsigned char tmpByte;
;         unsigned int tmpInt;
;         unsigned int dataCounter;
;         
;         // init.
;         dataCounter = 0;
	mov [X+1],0
	mov [X+0],0
	.dbline 233
	mov [X+4],0
	xjmp L17
L14:
	.dbline 233
;         
;         // each page
;         for (pageNo=0;pageNo<8;pageNo++) {
	.dbline 235
;         
;                 tmpByte = 0xb0 | pageNo;                                // set page address
	mov A,[X+4]
	or A,-80
	mov [X+5],A
	.dbline 236
;                 wrTxLm6023(0x00, tmpByte);
	mov A,[X+5]
	push A
	mov A,0
	push A
	xcall _wrTxLm6023
	add SP,-2
	.dbline 238
;                 
;                 wrTxLm6023(0x00, 0x10);                                      // set coloumn address (higher) at 0 position
	mov A,16
	push A
	mov A,0
	push A
	xcall _wrTxLm6023
	.dbline 239
;                 wrTxLm6023(0x00, 0x00);                                      // set coloumn address (lower)
	mov A,0
	push A
	push A
	xcall _wrTxLm6023
	add SP,-4
	.dbline 242
;                 
;                 // each segment in one page (adjust the code for more efficiency later)
;                 tmpInt = (pageNo+1)*128;
	mov A,[X+4]
	mov [__r1],A
	mov [__r0],0
	add [__r1],1
	adc [__r0],0
	asl [__r1]
	rlc [__r0]
	asl [__r1]
	rlc [__r0]
	asl [__r1]
	rlc [__r0]
	asl [__r1]
	rlc [__r0]
	asl [__r1]
	rlc [__r0]
	asl [__r1]
	rlc [__r0]
	asl [__r1]
	rlc [__r0]
	mov A,[__r1]
	mov [X+3],A
	mov A,[__r0]
	mov [X+2],A
	.dbline 243
	xjmp L21
L18:
	.dbline 243
;                 for (;dataCounter<tmpInt;dataCounter++) {
	.dbline 244
;                         if (pData!=ClearPaper) wrTxLm6023(0x01, *(pData+dataCounter));              // set data, coloumn address will auto. inc. inside LCD
	cmp [X-5],>_ClearPaper
	jnz X1
	cmp [X-4],<_ClearPaper
	jz L22
X1:
	.dbline 244
	mov A,[X+1]
	add A,[X-4]
	mov [__r1],A
	mov A,[X+0]
	adc A,[X-5]
	push X
	mov X,[__r1]
	romx
	pop X
	push A
	mov A,1
	push A
	xcall _wrTxLm6023
	add SP,-2
	xjmp L23
L22:
	.dbline 245
;                         else wrTxLm6023(0x01, 0);                                    // clear screen
	mov A,0
	push A
	mov A,1
	push A
	xcall _wrTxLm6023
	add SP,-2
L23:
	.dbline 246
L19:
	.dbline 243
	inc [X+1]
	adc [X+0],0
L21:
	.dbline 243
	mov A,[X+0]
	cmp A,[X+2]
	jnz X3
	mov A,[X+1]
	cmp A,[X+3]
	jz X2
X3:
	jc L18
X2:
	.dbline 248
L15:
	.dbline 233
	inc [X+4]
L17:
	.dbline 233
	cmp [X+4],8
	jz X4
	jc L14
X4:
	.dbline -2
	.dbline 249
;                 }
;                         
;         }
; }
L13:
	add SP,-6
	pop X
	.dbline 0 ; func end
	ret
	.dbsym l tmpByte 5 c
	.dbsym l pageNo 4 c
	.dbsym l tmpInt 2 i
	.dbsym l dataCounter 0 i
	.dbsym l pData -5 pc
	.dbend
	.dbfunc e GrTextDrv _GrTextDrv fV
;              p -> X+1
;              i -> X+0
;          flags -> X-7
;      font_code -> X-6
;              y -> X-5
;              x -> X-4
_GrTextDrv::
	.dbline -1
	push X
	mov X,SP
	add SP,5
	.dbline 261
; 
; /*
;  * Draw a text in the specified drawable using the
;  * specified graphics context.
;  *
;  * flags
;  *	bit 0 - '0' as high light off, '1' as high light on
;  */
; void
; GrTextDrv(GR_COORD x, GR_COORD y, unsigned char font_code,
; 	GR_TEXTFLAGS flags)
; {
	.dbline 265
;         unsigned char i;
;         const unsigned char* p;
; 	
; 		wrTxLm6023(0x00, 0xb0 | y);                                  // set page address
	mov A,[X-5]
	or A,-80
	push A
	mov A,0
	push A
	xcall _wrTxLm6023
	add SP,-2
	.dbline 267
; 		
; 		x *= 8;                                                 // set coloumn address 
	mov A,[X-4]
	asl A
	asl A
	asl A
	mov [X-4],A
	.dbline 268
; 		wrTxLm6023(0x00, 0x0f & x );                                         // lower
	mov A,[X-4]
	and A,15
	push A
	mov A,0
	push A
	xcall _wrTxLm6023
	.dbline 269
; 		wrTxLm6023(0x00, ((x>>4) & 0x1f) | 0x10 );                           // higher
	mov A,[X-4]
	asr A
	asr A
	asr A
	asr A
	and A,15
	mov [__r0],A
	and [__r0],31
	or [__r0],16
	mov A,[__r0]
	push A
	mov A,0
	push A
	xcall _wrTxLm6023
	add SP,-4
	.dbline 271
; 		
; 		switch (font_code) {
	mov A,[X-6]
	mov [X+4],A
	mov [X+3],0
	cmp [X+3],0
	jnz X6
	cmp [X+4],32
	jz L28
X6:
	cmp [X+3],0
	jnz X7
	cmp [X+4],33
	jz L30
X7:
	mov A,[X+3]
	xor A,-128
	mov [__rY],A
	mov A,0
	xor A,-128
	mov [__rZ],A
	mov [__rX],0
	mov A,[X+4]
	sub A,32
	or [__rX],A
	mov A,[__rY]
	sbb A,[__rZ]
	or [__rX],A
	jc L25
X8:
L31:
	cmp [X+3],0
	jnz X9
	cmp [X+4],-89
	jz L29
X9:
	xjmp L25
X5:
	.dbline 271
L28:
	.dbline 273
; 			case 0x20 : 
; 				 p = Font_SPACE;
	mov [X+2],<_Font_SPACE
	mov [X+1],>_Font_SPACE
	.dbline 274
; 				break;
	xjmp L26
L29:
	.dbline 276
; 			case 0xa7 : 
; 				 p = Font_DEGREE;
	mov [X+2],<_Font_DEGREE
	mov [X+1],>_Font_DEGREE
	.dbline 277
; 				break;
	xjmp L26
L30:
	.dbline 279
; 			case 0x21 : 
; 				 p = Font_EXC;
	mov [X+2],<_Font_EXC
	mov [X+1],>_Font_EXC
	.dbline 280
; 				break;
	xjmp L26
L25:
	.dbline 283
; 			default : 
; 				 //p = Font_Table[font_code-0x2A];
; 				 p = Font_Table[font_code-0x2E];
	mov A,[X-6]
	mov [__r1],A
	mov [__r0],0
	sub [__r1],46
	sbb [__r0],0
	asl [__r1]
	rlc [__r0]
	asl [__r1]
	rlc [__r0]
	asl [__r1]
	rlc [__r0]
	mov A,[__r1]
	add A,<_Font_Table
	mov [X+2],A
	mov A,[__r0]
	adc A,>_Font_Table
	mov [X+1],A
	.dbline 284
; 				break;
L26:
	.dbline 287
; 		}
; 		
; 		for (i=0;i<8;i++)                                       // wr. 8 bytes data for one fonts (8x8 in size), set data, coloumn address will auto. inc. inside LCD
	mov [X+0],0
	xjmp L35
L32:
	.dbline 289
; 			//if (flags&0x01) {
; 			if (flags) {
	cmp [X-7],0
	jz L36
	.dbline 289
	.dbline 290
; 				wrTxLm6023(0x01, ~(*(p+i)) );
	mov A,[X+0]
	mov [__r1],A
	mov [__r0],0
	mov A,[X+2]
	add [__r1],A
	mov A,[X+1]
	adc [__r0],A
	mov A,[__r0]
	push X
	mov X,[__r1]
	romx
	pop X
	cpl A
	push A
	mov A,1
	push A
	xcall _wrTxLm6023
	add SP,-2
	.dbline 291
	xjmp L37
L36:
	.dbline 291
; 			} else {
	.dbline 292
; 				wrTxLm6023(0x01, *(p+i));
	mov A,[X+0]
	mov [__r1],A
	mov [__r0],0
	mov A,[X+2]
	add [__r1],A
	mov A,[X+1]
	adc [__r0],A
	mov A,[__r0]
	push X
	mov X,[__r1]
	romx
	pop X
	push A
	mov A,1
	push A
	xcall _wrTxLm6023
	add SP,-2
	.dbline 293
; 			}
L37:
L33:
	.dbline 287
	inc [X+0]
L35:
	.dbline 287
	cmp [X+0],8
	jz X10
	jc L32
X10:
	.dbline -2
	.dbline 294
; }
L24:
	add SP,-5
	pop X
	.dbline 0 ; func end
	ret
	.dbsym l p 1 pc
	.dbsym l i 0 c
	.dbsym l flags -7 c
	.dbsym l font_code -6 c
	.dbsym l y -5 c
	.dbsym l x -4 c
	.dbend
