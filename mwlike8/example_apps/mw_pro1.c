#include "app.h"

#ifdef I386_LINUX
#include <stdio.h>
#include <stdlib.h>
#define MWINCLUDECOLORS
#include "microwin/nano-X.h"
#endif
#ifdef CYPRESS_PSOC
#include "nano-X.h"
#include "sched.h"
#include "timer.h"
#include "printf.h"
#endif

#ifdef I386_LINUX
GR_WINDOW_ID  wid;
GR_GC_ID      gc;
GR_BITMAP eyeclose_bits[] = {
	0xfffe, 0x00ff, 0xfe00, 0xfff0, 0x001f, 0xfe00, 0xffc0, 0x0007, 
	0xfe00, 0xff01, 0xff01, 0xfe00, 0xfe0f, 0xffe0, 0xfe00, 0xfc3f, 
	0xfff8, 0x7e00, 0xf87f, 0xfffc, 0x3e00, 0xf0ff, 0xfffe, 0x1e00, 
	0xe1ff, 0xffff, 0x0e00, 0xe3ff, 0xffff, 0x8e00, 0xc7ff, 0xffff, 
	0xc600, 0xc7ff, 0xffff, 0xc600, 0x8fff, 0xffff, 0xe200, 0x8fff, 
	0xffff, 0xe200, 0x8fff, 0xffff, 0xe200, 0x1fff, 0xffff, 0xf000, 
	0x1fff, 0xffff, 0xf000, 0x1fff, 0xffff, 0xf000, 0x1fff, 0xffff, 
	0xf000, 0x1fff, 0xffff, 0xf000, 0x1fff, 0xffff, 0xf000, 0x1fff, 
	0xffff, 0xf000, 0x01ff, 0xfffe, 0x0000, 0x0001, 0xff00, 0x0000, 
	0x8000, 0x0000, 0x0200, 0x8800, 0x0000, 0x2200, 0x8ff0, 0x001f, 
	0xe200, 0xc7ff, 0xffff, 0xc600, 0xc7ff, 0xffff, 0xc600, 0xe3ff, 
	0xffff, 0x8e00, 0xe1ff, 0xffff, 0x0e00, 0xf0ff, 0xfffe, 0x1e00, 
	0xf87f, 0xfffc, 0x3e00, 0xfc3f, 0xfff8, 0x7e00, 0xfe0f, 0xffe0, 
	0xfe00, 0xff01, 0xff01, 0xfe00, 0xffc0, 0x0007, 0xfe00, 0xfff0, 
	0x001f, 0xfe00, 0xfffe, 0x00ff, 0xfe00, };
#endif
#ifdef CYPRESS_PSOC
const unsigned char AmonicsLogo[]=
{ 

	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // Page:1
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xF0, 
	0xF0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // Page:2
	0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 
	0x80, 0x80, 0x80, 0xC0, 0xF0, 0xFE, 0xFF, 0xFF, 
	0xFF, 0xFF, 0xFF, 0xF8, 0xC0, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	
	0x00, 0x00, 0x00, 0xC0, 0xE0, 0xF0, 0x78, 0x3C, // Page:3
	0x1E, 0x0F, 0x07, 0x07, 0x03, 0x03, 0x03, 0x03, 
	0xC3, 0xFB, 0xFF, 0x7F, 0x0F, 0x3F, 0xFF, 0xFF, 
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF8, 0xC0, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	
	0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x01, 0x00, 0x00, // Page:4
	0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xF8, 0xFE, 
	0x7F, 0x0F, 0x01, 0x00, 0x00, 0x00, 0x01, 0x0F, 
	0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 
	0xFF, 0xF8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 
	0x80, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 
	0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x3E, 
	0x7F, 0x7F, 0x7F, 0x7F, 0x3E, 0x1C, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	
	0x00, 0x00, 0x07, 0x1F, 0x3F, 0xFC, 0xF0, 0xC0, // Page:5
	0x80, 0x80, 0xC0, 0xF8, 0xFE, 0x7F, 0x0F, 0x0F, 
	0x0E, 0x0E, 0x0E, 0x0E, 0x0E, 0x0E, 0x0E, 0x8E, 
	0xCE, 0xEF, 0xFF, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 
	0xFF, 0xFF, 0xFF, 0xFF, 0xF8, 0xC0, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xFF, 0xFF, 
	0xFF, 0xFF, 0x0E, 0x07, 0x07, 0xFF, 0xFF, 0xFF, 
	0xFE, 0xFC, 0x06, 0x07, 0x0F, 0xFF, 0xFF, 0xFF, 
	0xFE, 0x00, 0xF0, 0xFC, 0xFE, 0xFF, 0xFF, 0x03, 
	0x03, 0x03, 0xFF, 0xFF, 0xFE, 0xFC, 0xE0, 0x01, 
	0x03, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x07, 0x07, 
	0xFF, 0xFF, 0xFF, 0xFE, 0xFC, 0x00, 0x00, 0x03, 
	0x07, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0xF0, 0xFC, 
	0xFE, 0xFF, 0x8F, 0x03, 0x0F, 0x3F, 0x3F, 0x3E, 
	0x3C, 0x00, 0x7C, 0xFF, 0xFF, 0xFB, 0xF3, 0xE3, 
	0xC7, 0xBF, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 
	
	0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0xE1, 0xF1, // Page:6
	0xFB, 0xFF, 0xFF, 0xFF, 0xFF, 0xEE, 0xCE, 0xCE, 
	0xCE, 0x0E, 0x0E, 0x0E, 0x0E, 0x07, 0x07, 0x03, 
	0x03, 0xC1, 0xC0, 0xC0, 0xC1, 0xFF, 0xFF, 0xFF, 
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF8, 
	0xE0, 0xC0, 0xC0, 0x00, 0xC0, 0xFF, 0xFF, 0xFF, 
	0xFF, 0xFF, 0xC0, 0x80, 0xC0, 0xFF, 0xFF, 0xFF, 
	0xFF, 0xFF, 0xC0, 0x80, 0xE0, 0xFF, 0xFF, 0xFF, 
	0xFF, 0xC0, 0x8F, 0x3F, 0x7F, 0xFF, 0xFF, 0xC0, 
	0xC0, 0xC0, 0xFF, 0xFF, 0x7F, 0x3F, 0x0F, 0x80, 
	0xC0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x80, 0xC0, 
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xC0, 0x00, 0x80, 
	0xC0, 0xFF, 0xFF, 0xFF, 0xFF, 0xC0, 0x8F, 0x3F, 
	0x7F, 0xFF, 0xFF, 0xF8, 0xE0, 0xE0, 0xE0, 0x70, 
	0x38, 0x00, 0xFC, 0xF9, 0xE3, 0xC3, 0xC7, 0xDF, 
	0xFF, 0xFF, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 
	
	0x00, 0x00, 0x00, 0x30, 0x48, 0x48, 0x98, 0x20, // Page:7
	0xE0, 0x20, 0x20, 0xC0, 0x00, 0xC0, 0xA0, 0xC0, 
	0x00, 0xC0, 0x20, 0x20, 0x00, 0x20, 0xE8, 0x00, 
	0x00, 0xA0, 0xA0, 0xC0, 0x00, 0xF8, 0x00, 0xE8, 
	0x00, 0xC0, 0xA0, 0x20, 0x00, 0xF0, 0x20, 0x00, 
	0x00, 0x00, 0x00, 0x20, 0xE8, 0x00, 0xE0, 0x40, 
	0x20, 0xE0, 0x00, 0x00, 0x00, 0xF0, 0x08, 0x08, 
	0x08, 0xF0, 0x20, 0xE0, 0x20, 0x20, 0xC0, 0x20, 
	0xF0, 0x20, 0x00, 0xE8, 0x00, 0xC0, 0x20, 0x21, 
	0x01, 0xA1, 0x60, 0xC0, 0x00, 0x08, 0xF8, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x98, 0xE0, 
	0x00, 0x00, 0x00, 0xE0, 0x20, 0xE0, 0x20, 0xC0, 
	0x20, 0xE0, 0x20, 0x20, 0xC0, 0x00, 0xF8, 0x00, 
	0xE8, 0x00, 0x20, 0xF1, 0x29, 0x08, 0x20, 0xE8, 
	0x00, 0xC0, 0xA1, 0xC0, 0x00, 0xE1, 0x21, 0x21, 
	0xC0, 0xA0, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 
	
	0x00, 0x00, 0x00, 0x03, 0x02, 0x02, 0x01, 0x08, // Page:8
	0x0F, 0x0A, 0x02, 0x01, 0x00, 0x01, 0x02, 0x02, 
	0x00, 0x01, 0x02, 0x02, 0x00, 0x02, 0x03, 0x02, 
	0x00, 0x03, 0x02, 0x03, 0x00, 0x03, 0x00, 0x03, 
	0x00, 0x02, 0x02, 0x01, 0x00, 0x03, 0x02, 0x02, 
	0x00, 0x00, 0x00, 0x02, 0x03, 0x02, 0x03, 0x02, 
	0x00, 0x03, 0x02, 0x00, 0x00, 0x01, 0x02, 0x02, 
	0x02, 0x01, 0x08, 0x0F, 0x0A, 0x02, 0x01, 0x00, 
	0x03, 0x02, 0x02, 0x03, 0x02, 0x01, 0x02, 0x02, 
	0x00, 0x03, 0x02, 0x03, 0x00, 0x02, 0x03, 0x02, 
	0x00, 0x00, 0x00, 0x02, 0x03, 0x00, 0x00, 0x02, 
	0x03, 0x02, 0x00, 0x03, 0x00, 0x03, 0x00, 0x03, 
	0x08, 0x0F, 0x0A, 0x02, 0x01, 0x00, 0x03, 0x00, 
	0x03, 0x00, 0x02, 0x03, 0x02, 0x00, 0x02, 0x03, 
	0x02, 0x01, 0x02, 0x02, 0x00, 0x03, 0x00, 0x00, 
	0x02, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00

};
extern unsigned char ClearPaper[];
#endif

void mwlike8_process1(void)
{
	
	GR_EVENT	event;		// current event
	#define	TIME_OUT_INIT		0
	#define	TIME_OUT_INIT1		TIME_OUT_INIT + 1
	#define	TIME_OUT_INIT2		TIME_OUT_INIT1 + 1
	#define	TIME_OUT_INIT3		TIME_OUT_INIT2 + 1
	#define	TIME_OUT_STATIC_SCR	TIME_OUT_INIT3 + 1
	#define	TIME_OUT_		TIME_OUT_STATIC_SCR + 1
	unsigned char timeout_task = TIME_OUT_INIT;
	
						 int a = 0;
						 char vec[10];
	
#ifdef I386_LINUX
    if (GrOpen() < 0)
    {
        fprintf (stderr, "GrOpen failed");
        exit (1);
    }

    wid = GrNewWindowEx (GR_WM_PROPS_APPFRAME |
                         GR_WM_PROPS_CAPTION  |
                         GR_WM_PROPS_CLOSEBOX,
                         "H W H",
                         GR_ROOT_WINDOW_ID, 
                         1, 1, 100, 40, WHITE);

    GrSelectEvents (wid, GR_EVENT_MASK_EXPOSURE | 
                         GR_EVENT_MASK_CLOSE_REQ);
			 
    gc = GrNewGC();
    GrSetGCUseBackground(gc, GR_FALSE);
    GrSetGCForeground(gc, RED);

    //GrMapWindow (wid);
	GrBitmap(wid, gc, 0, 0, 39, 39, eyeclose_bits);
#endif
#ifdef CYPRESS_PSOC
	msleep(100);									// let mwlinke8 server has enough time to init.
//	GrMapWindow();
	GrBitmap(AmonicsLogo);
	buz_one_shot();
#endif
    
	while (1) {
		GrGetNextEventTimeout(&event, 300);					// check events
		switch (event.type) {
			case GR_EVENT_TYPE_EXPOSURE:					// display init. screen on startup
				break;
	
#ifdef I386_LINUX
			case GR_EVENT_TYPE_CLOSE_REQ:
				GrClose();
				exit(0);
#endif
	
			case GR_EVENT_TYPE_TIMEOUT:
			
		// display each regular time
				 switch (timeout_task) {
					case TIME_OUT_INIT :				//	for around 1 sec for logo
						 timeout_task = TIME_OUT_INIT1;
						break;
					case TIME_OUT_INIT1 :
						 timeout_task = TIME_OUT_INIT2;
						break;
					case TIME_OUT_INIT2 :
						 timeout_task = TIME_OUT_INIT3;
						break;
					case TIME_OUT_INIT3 :				
#ifdef CYPRESS_PSOC
						 GrBitmap(ClearPaper);
#endif
						 timeout_task = TIME_OUT_STATIC_SCR;
						break;
					case TIME_OUT_STATIC_SCR :
						 GrText_const(0,0,"i/p Pwr:", 8, 0);GrText_const(14,0,"mW", 2, 0);
						 GrText_const(0,1,"o/p Pwr:", 8, 0);GrText_const(14,1,"mW", 2, 0);
						 timeout_task = TIME_OUT_;
						break;
					case TIME_OUT_ :
#ifdef CYPRESS_PSOC
						// bug in overflow, a = 32767 only
						 print_integer(vec, "05", a);
						 GrText_buf(3,3,vec, 5, 0);
						 a++;
#endif
#ifdef I386_LINUX
						 GrText (wid, gc, 50, 50,
							"H W C#2",  -1, GR_TFASCII);
#endif
						break;
				 }
				 
				break;
			case GR_EVENT_TYPE_KEY_DOWN :
				 GrText_const(1,5,"DOWN", 4, 0);
				 switch (event.keystroke.ch) {
					 case GR_KEY_ENTER : 
						 GrText_const(5,5," ENTER", 6, 0);
						break;
					 case GR_SPECIAL_KEY_ARROW_UP : 
						 GrText_const(5,5," UP   ", 6, 0);
						break;
					 case GR_SPECIAL_KEY_ARROW_DOWN : 
						 GrText_const(5,5," DOWN ", 6, 0);
						break;
				 }
				break;
			case GR_EVENT_TYPE_KEY_UP :
				 GrText_const(1,5,"UP  ", 4, 0);
				 switch (event.keystroke.ch) {
					 case GR_KEY_ENTER : 
						 GrText_const(5,5," ENTER", 6, 0);
						break;
					 case GR_SPECIAL_KEY_ARROW_UP : 
						 GrText_const(5,5," UP   ", 6, 0);
						break;
					 case GR_SPECIAL_KEY_ARROW_DOWN : 
						 GrText_const(5,5," DOWN ", 6, 0);
						break;
				 }
				break;
		}
	}
}
